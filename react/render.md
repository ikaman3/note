# render

컴포넌트를 화면에 표시하기 이전에 리액트에서 렌더링해야 한다.  

> 렌더링은 항상 순수한 계산:  
>  
> - 동일한 입력에는 동일한 출력  
> - 이전의 state를 변경해서는 안 됨

## UI 요청 및 제공 단계

1. 렌더링 트리거
2. 컴포넌트 렌더링
3. DOM에 커밋

### 1단계: 렌더링 트리거

컴포넌트 렌더링이 일어나는 데에는 두 가지 이유가 있다.  

1. 컴포넌트의 초기 렌더링인 경우
2. 컴포넌트의 state가 업데이트된 경우  

#### 초기 렌더링

앱이 시작할 때 초기 렌더링을 한다.  
대상 DOM 노드로 `createRoot`를 호출한 다음 해당 컴포넌트로 `render` 메서드를 호출하여 수행한다.  

- 프레임워크나 샌드박스에서는 이 코드를 숨기기도 하지만, 내부적으로 수행된다.  

#### state 업데이트 시 리렌더링

컴포넌트가 처음으로 렌더링되면, `set` 함수를 사용하여 추가적인 렌더링을 트리거할 수 있다.  
컴포넌트의 상태를 업데이트하면 자동으로 렌더링이 대기열에 추가된다.  

### 2단계: 리액트 컴포넌트 렌더링

렌더링을 트리거한 후 리액트는 컴포넌트를 호출해 화면에 표시할 내용을 파악한다.  

> **"렌더링"이란 "리액트에서 컴포넌트를 호출하는 것"**이다.  

- 초기 렌더링에서 루트 컴포넌트를 호출
- 이후 렌더링에서 state 업데이트가 일어나 렌더링을 트리거한 컴포넌트를 호출

> 렌더링은 재귀적 단계:  
>  
> 업데이트된 컴포넌트가 다른 컴포넌트를 반환하면  
> 리액트는 다음으로 해당 컴포넌트를 렌더링하고  
> 해당 컴포넌트도 컴포넌트를 반환하면 반환된 컴포넌트를 다음에 렌더링한다.  
> 중첩된 컴포넌트가 더 이상 없고, 리액트가 화면에 표시될 내용을 정확히 알 때까지 이 단계는 계속된다.  

### 3단계: 리액트가 DOM에 변경사항을 커밋

컴포넌트를 렌더링(호출)한 후 리액트는 DOM을 수정한다.  

- 초기 렌더링의 경우: `appendChild()` DOM API를 사용하여 생성한 모든 DOM 노드를 화면에 표시  
- 리렌더링의 경우: 필요한 최소한의 작업을 적용해 DOM을 최신 렌더링 출력과 일치시킴

> 리액트는 렌더링 간에 차이가 있는 경우에만 DOM 노드를 변경한다.  
> - 매초 부모로부터 전달된 다른 props로 리렌더링하는 컴포넌트가 있을 때 `<input>`에 텍스트를 입력하여 `value`를 업데이트해도 리렌더링할 때 텍스트가 사라지지 않음
> - 리액트가 마지막 단계에서 `<h1>`의 내용만 새로운 `time`으로 업데이트하기 때문이다.  

## 브라우저 페인트

> 렌더링이 완료되고 리액트가 DOM을 업데이트한 후 브라우저는 화면을 다시 그린다.  
> 이 단계를 "브라우저 렌더링"이라고 하지만 혼동을 피하고자 "페인팅"으로 지칭한다.  